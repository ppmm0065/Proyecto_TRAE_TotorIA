{% extends 'base.html' %}

{% block title %}Alumnos con observaciones críticas por nivel{% endblock %}

{% block panel_center_content %}
  <h1 class="text-xl font-semibold text-slate-800 mb-4 text-center">
    <i class="fas fa-user-shield text-red-600 mr-2"></i>
    Alumnos con observaciones críticas por nivel
  </h1>

  {% if not alertas_observaciones or alertas_observaciones|length == 0 %}
    <div class="p-4 bg-slate-50 border border-slate-200 rounded-md text-center text-slate-600">
      No se encontraron alumnos con observaciones críticas por nivel.
    </div>
  {% else %}
    {% if ordered_levels is defined and ordered_levels|length > 0 %}
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
        {% for nivel in ordered_levels %}
          {% set alumnos = alertas_observaciones.get(nivel) %}
          {% if alumnos %}
            <div class="mb-2">
              <h2 class="text-xs font-semibold text-slate-700 uppercase tracking-wider mb-2">{{ nivel }}</h2>
              <div class="space-y-2">
                {% for alumno in alumnos %}
                  <a href="{{ url_for('main.detalle_entidad', tipo_entidad='alumno', valor_codificado=alumno.nombre) }}" class="block">
                    <div class="p-4 bg-white rounded-lg shadow border border-slate-200 hover:shadow-md transition-shadow">
                      <div class="flex items-center justify-between mb-1">
                        <h3 class="text-sm font-semibold text-slate-800">{{ alumno.nombre }}</h3>
                        <span class="text-xs font-bold text-red-700 bg-red-100 px-2 py-1 rounded-full">Obs.</span>
                      </div>
                      <p class="text-xs text-slate-600 mb-2">{{ alumno.curso_original }}</p>
                      <p class="text-sm text-slate-700 line-clamp-2">{{ alumno.observacion }}</p>
                    </div>
                  </a>
                {% endfor %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% else %}
      {# Fallback: ordenar por clave de nivel como antes #}
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
        {% for nivel, alumnos in alertas_observaciones|dictsort %}
          {% if alumnos %}
            <div class="mb-2">
              <h2 class="text-xs font-semibold text-slate-700 uppercase tracking-wider mb-2">{{ nivel }}</h2>
              <div class="space-y-2">
                {% for alumno in alumnos %}
                  <a href="{{ url_for('main.detalle_entidad', tipo_entidad='alumno', valor_codificado=alumno.nombre) }}" class="block">
                    <div class="p-4 bg-white rounded-lg shadow border border-slate-200 hover:shadow-md transition-shadow">
                      <div class="flex items-center justify-between mb-1">
                        <h3 class="text-sm font-semibold text-slate-800">{{ alumno.nombre }}</h3>
                        <span class="text-xs font-bold text-red-700 bg-red-100 px-2 py-1 rounded-full">Obs.</span>
                      </div>
                      <p class="text-xs text-slate-600 mb-2">{{ alumno.curso_original }}</p>
                      <p class="text-sm text-slate-700 line-clamp-2">{{ alumno.observacion }}</p>
                    </div>
                  </a>
                {% endfor %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% endif %}
  {% endif %}

  <div class="mt-6 flex justify-center">
    <a href="{{ url_for('main.index') }}" class="inline-flex items-center px-4 py-2 text-sm font-medium text-slate-700 bg-slate-100 hover:bg-slate-200 rounded">
      <i class="fas fa-arrow-left mr-2"></i> Volver al inicio
    </a>
  </div>
{% endblock %}

